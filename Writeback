

import clr
clr.AddReference("System.Windows.Forms")
from System.Windows.Forms import MessageBox
from Spotfire.Dxp.Data import DataPropertyClass
from Spotfire.Dxp.Data import DataTable
from Spotfire.Dxp.Data import DataValueCursor
from System.Collections import IEnumerable
from Spotfire.Dxp.Data import DataPropertyClass
from Spotfire.Dxp.Application.Scripting import ScriptDefinition
from System.Collections.Generic import List, Dictionary
from System import String
#MessageBox.Show("Do you want to update record?")
Document.Properties["tempaccrecid"]=""
selDriver = DataValueCursor.CreateFormatted(table.Columns["Driver Name"])
selAccRec = DataValueCursor.CreateFormatted(table.Columns["Account Rec ID"])
selReason = DataValueCursor.CreateFormatted(table.Columns["Reason For Unrec"])
selAction_Plan = DataValueCursor.CreateFormatted(table.Columns["Action Plan"])
selClosed_Date = DataValueCursor.CreateFormatted(table.Columns["Input Exp Closed DT"])
selStatus = DataValueCursor.CreateFormatted(table.Columns["STATUS_CD"])
selPL_Impact = DataValueCursor.CreateFormatted(table.Columns["EST_PL_IMPACT_AMT"])
selOwner = DataValueCursor.CreateFormatted(table.Columns["Rec Team Owner"])
selAccntMngr = DataValueCursor.CreateFormatted(table.Columns["Accountable Manager"])
selHelp = DataValueCursor.CreateFormatted(table.Columns["Dependency/Help"])
selLeader = DataValueCursor.CreateFormatted(table.Columns["Accountable Leader"])
selPending = DataValueCursor.CreateFormatted(table.Columns["#Pending Actions"])
selExpectPerRecon = DataValueCursor.CreateFormatted(table.Columns["Exptd Period Reconciled"])


markedRows = Document.Data.Markings["Update"].GetSelection(table).AsIndexSet()
tblgetrows = IEnumerable.GetEnumerator(table.GetRows(markedRows, selDriver, selAccRec, selReason, selAction_Plan, selClosed_Date, selStatus, selPL_Impact, selOwner, selAccntMngr, selHelp, selLeader, selPending, selExpectPerRecon ))

try:
		for row in tblgetrows:
			Document.Properties["tempdriver"]=selDriver.CurrentValue
			Document.Properties["tempaccrecid"]=selAccRec.CurrentValue
			Document.Properties["IReasonForUnrec"]=selReason.CurrentValue
			Document.Properties["IActionPlan"]=selAction_Plan.CurrentValue
			Document.Properties["tempdate"]=selClosed_Date.CurrentValue
			Document.Properties["iStatusCd"]=selStatus.CurrentValue
			Document.Properties["tempplimpactamt"]=selPL_Impact.CurrentValue
			Document.Properties["irecteam"]=selOwner.CurrentValue
			Document.Properties["iAccntMngr"]=selAccntMngr.CurrentValue
			Document.Properties["temphelp"]=selHelp.CurrentValue
			Document.Properties["tempaccleader"]=selLeader.CurrentValue
			Document.Properties["temppendingaction"]=selPending.CurrentValue
			Document.Properties["tempExpectPerRecon"]=selExpectPerRecon.CurrentValue
			

finally:
		tblgetrows.Dispose()
		
if len(Document.Properties["tempdriver"])==0:
   Document.Properties["IDriverNme"]=Null
else:
  Document.Properties["IDriverNme"]=Document.Properties["tempdriver"]
  
if String.IsNullOrEmpty(Document.Properties["tempplimpactamt"])==True:
   Document.Properties["iEstPlImpactAmt"]=Null
else:
   Document.Properties["iEstPlImpactAmt"]=Document.Properties["tempplimpactamt"]
   
if str(Document.Properties["tempdate"])=="":
 Document.Properties["iExpectedCloseDt"]=None
else:
  Document.Properties["iExpectedCloseDt"]=Document.Properties["tempdate"]

if String.IsNullOrEmpty(Document.Properties["temphelp"])==True:
   Document.Properties["ihelp"]=Null
else:
   Document.Properties["ihelp"]=Document.Properties["temphelp"]
   
if String.IsNullOrEmpty(Document.Properties["tempaccrecid"])==True:
   Document.Properties["Messagetext"]="Mark at least one record to update"
else:
  Document.Properties["Messagetext"]=""

if len(Document.Properties["tempaccleader"])==0:
   Document.Properties["Iaccleader"]=Null
else:
   Document.Properties["Iaccleader"]=Document.Properties["tempaccleader"]

if len(Document.Properties["temppendingaction"])==0:
   Document.Properties["Ipendingaction"]=Null
else:
   Document.Properties["Ipendingaction"]=Document.Properties["temppendingaction"]
   
if len(Document.Properties["tempExpectPerRecon"])==0:
   Document.Properties["iExpectPerRecon"]=Null
else:
  Document.Properties["iExpectPerRecon"]=Document.Properties["tempExpectPerRecon"]
